$(document).ready(function(){
  $('.slider').slider();
  var currentURL = window.location.href;
  console.log(document.title)

  var page = document.title;

  if (window.location.search){
    console.log(window.location.search);
    var query = window.location.search.substring(3);
    console.log(query);
    searchMovies(query)
  }
  function searchMovies(movie) {
      var queryURL = "https://www.omdbapi.com/?t=" + movie + "&y=&plot=full&apikey=trilogy";
    $.ajax({
        url: queryURL,
        method: "GET"
    }).then(function(response) {

    // Printing the entire object to console
        console.log(response);
        
        var posterURL = response.Poster;
        var moviePoster = $("<img>").attr("src", response.Poster);
        moviePoster.addClass("poster");
        var movieDetails = $("<h1>").text("Movie Details: ");
        movieDetails.addClass("movie-details");
        var movieRating = $("<h4>").text("Rating: " + response.Rated);
        movieRating.addClass("movie-rating");
        var movieReleased = $("<h4>").text("Released: " + response.Released);
        movieReleased.addClass("released");
        var time = $("<h5>").text("Runtime: " + response.Runtime);
        time.addClass("time");
        var score = $("<h5>").text("Metascore: " + response.Metascore);
        score.addClass("score");
        var moviePlot = $("<h5>").text("Plot Summary: " + response.Plot);
        var cast = $("<h5>").text("Cast: " + response.Actors);
        cast.addClass("cast-list");
        
        var amazonURL = "https://www.amazon.com/s/ref=nb_sb_noss_2?url=search-alias%3Dmovies-tv&field-keywords=" + movie;
        var amazon = $("<a>").text("Click Here to go to Amazon Product Page").attr("href", amazonURL).attr("target", "_blank").addClass("link");
        
        var rtURL = "https://www.rottentomatoes.com/m/" + movie;
        var rt = $("<a>").text("Click Here to go to Rotten Tomatoes Movie Page").attr("href", rtURL).attr("target", "_blank").addClass("link");
        var fandangoURL = "https://www.fandango.com/moviesintheaters?GenreFilter=Family";
        var fandango = $("<a>").text("Click Here to go to Fandango").attr("href", fandangoURL).attr("target", "_blank").addClass("link");
        console.log(amazon);
        // $("#search-results").empty();
        $("#search-results").append(moviePoster, movieDetails, movieRating, movieReleased, score, time, moviePlot, cast, amazon, "<br>", rt, "<br>", fandango, "<br>");
        searchGIFs(movie);
    });    
  };
  function searchGIFs(movie) {
        
        var queryURL = "https://api.giphy.com/v1/gifs/search?q=" +
        movie + "&api_key=dc6zaTOxFJmzC&limit=5&rating=y&rating=g";

    // Performing an AJAX request with the queryURL
        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(function(response1) {
          var gifs = response1.data;
          console.log(response1);
        
        // Looping through each result item
        for (var i = 0; i < gifs.length; i++) {          

            // Creating a paragraph tag with the result item's rating
            var para = $("<p>").text("Rating: " + gifs[i].rating);
            para.addClass("gif-rating");

            // Creating and storing an image tag
            var movieImage = $("<img>");
            movieImage.addClass("gif-image");
            
            // Setting the src attribute of the image to a property pulled off the result item
              movieImage.attr("src", gifs[i].images.fixed_height.url);
              movieImage.data("animate", gifs[i].images.fixed_height.url);
              movieImage.data("still", gifs[i].images.fixed_height_still.url);
              movieImage.data("state", "animate");
              movieImage.addClass("gif");

            $("#search-results").append(para);
            $("#search-results").append(movieImage);
            }
            //function changeImage() {
             // var state = $(this).data("state");
          
              //if (state === "still") {
                  //$(this).attr("src", $(this).data("animate"));
                 // $(this).data("state", "animate");
              //} else {
                  //$(this).attr("src", $(this).data("still"));
                  //$(this).data("state", "still");
             // }
           // };      
        });
      };
      
  $(document).on("click", ".btn", function(event) {
    // Preventing the button from trying to submit search value
    event.preventDefault();
    $("#search-results").empty();
    // Storing the movie name
    var underScore = $("#search").val();
    var inputMovie = underScore.split(" ").join("_");
    localStorage.setItem("movie", inputMovie) 
    
    if (page === "Kiddie Korner Ratings - Main") {
      window.location.href=("./search.html?q=" + inputMovie);
    }
    searchMovies(inputMovie);
    // searchGIFs(inputMovie);

    inputMovie = $(".input-field input").val("");
  });
  //$(document).on("click", ".gif-image", changeImage);
});
